// data parsing script
// cat multiTimeline.csv | sed '1,2d' | ruby -rcsv -e 'puts CSV.parse(STDIN).transpose.map &:to_csv'

// month parsing script
// cat climate_data.csv | sed '1,3d' | awk -F',' '{print $1}' | awk '{ print "\""$0"\""}' | tr '\n' ','

climate_data =[
["ozone",18,18,19,20,19,14,15,14,17,18,18,18,18,24,20,24,20,17,14,15,16,16,16,14,15,16,14,17,16,12,12,12,13,15,14,13,12,13,13,14,13,11,11,12,13,14,14,12,11,12,13,14,13,12,11,11,10,12,11,10,10,12,12,13,12,11,14,13,14,14,14,12,12,12,12,14,13,10,10,11,11,11,11,10,10,11,11,12,11,11,10,11,11,11,11,10,10,11,10,11,11,10,9,9,10,11,11,10,10,10,10,11,11,9,9,9,11,10,10,10,10,10,11,11,11,9,9,9,11,10,11,10,10,10,11,12,11,9,9,10,11,11,11,10,10,11,12,13,12,9,9,10,11,11,11,12,12,13,14,13,14,10,9,9,11,13,12,10,11,11,12,14,15,10,9,11,12,12,12,11,11,12,13,15,14,10,9,10,13,14,12,11,13,14,16,22,17,12,12,12,14,13,11,13,10,11,11,12,12,9,10,10,11,10,10,9,9,9,10,12],
["global warming",17,23,19,22,23,14,7,8,18,23,27,23,22,23,21,23,21,13,11,10,28,26,30,22,22,27,30,43,38,31,31,22,33,35,41,46,65,86,87,100,80,34,29,26,38,60,65,50,40,44,47,68,58,29,20,15,29,35,35,33,30,32,34,41,31,21,16,11,22,29,43,53,28,33,26,28,23,11,8,7,13,16,18,17,15,18,16,18,16,11,9,10,13,13,16,13,13,14,15,15,13,7,9,7,10,12,16,12,11,12,11,14,15,7,5,6,9,10,10,10,17,13,12,14,18,8,6,5,10,10,12,9,9,12,13,14,12,8,6,6,10,11,14,20,9,11,12,14,13,6,5,6,9,10,18,14,13,15,14,14,15,11,6,6,13,10,10,12,14,9,9,12,10,5,4,5,6,11,11,9,13,15,13,14,17,7,6,7,13,11,10,8,10,10,7,8,6,4,3,3,8,6,5,5,4,7,5,6,5,4,4,4,5,5,5,6,4,5,4,4],
["oil spill",1,1,1,1,1,0.5,0.5,0.5,1,1,1,2,1,1,1,1,1,1,0.5,0.5,1,1,1,1,1,1,1,1,1,0.5,0.5,1,1,1,1,0.5,0.5,1,1,1,1,0.5,0.5,0.5,0.5,1,3,1,1,1,1,1,1,0.5,1,0.5,0.5,1,0.5,0.5,0.5,1,1,1,0.5,0.5,0.5,0.5,0.5,1,1,0.5,1,0.5,0.5,7,90,100,35,8,9,6,3,3,3,2,3,3,2,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,2,1,0.5,0.5,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.5,0.5,1,1,1,1,1,1,1,1,1,1,0.5,1,1,1,1,1,1,1,1,1,0.5,1,0.5,1,1,1,0.5,0.5,0.5,1,1,1,1,0.5,1,0.5,0.5,3,1,0.5,1,1,1,0.5],
["carbon",17,18,18,17,16,14,14,16,18,20,20,18,18,19,17,18,17,15,14,14,17,18,17,16,16,16,16,15,14,14,14,14,16,20,30,24,22,22,21,21,20,18,17,17,20,22,22,20,21,21,20,22,20,18,17,16,20,22,22,21,20,20,22,21,19,17,17,17,21,22,21,20,20,20,21,20,18,16,14,15,18,19,19,17,18,20,20,19,18,16,16,16,21,21,21,17,19,20,18,19,18,15,15,17,21,22,21,18,19,21,19,21,19,15,15,15,21,23,21,19,20,22,20,21,20,16,15,16,23,23,21,20,20,22,21,22,19,16,16,16,24,24,23,21,21,24,22,21,20,16,15,17,23,24,23,21,21,23,22,21,19,18,16,17,23,25,24,21,24,42,26,24,22,18,18,19,24,27,24,23,23,25,23,23,23,19,18,19,25,26,24,23,23,27,27,28,26,22,20,20,30,30,24,24,23,28,25,25,22,19,18,20,24,24,25,22,23,23,22,21],
["climate change", 16,28,24,22,18,16,13,15,19,21,24,17,22,24,21,18,21,18,17,15,18,20,24,20,18,22,24,21,22,20,17,16,21,29,35,21,34,49,43,42,40,33,29,28,32,38,42,37,33,35,35,39,35,30,29,27,31,33,33,28,28,31,34,32,30,32,27,27,36,53,66,80,44,43,44,38,31,24,21,22,25,31,32,24,25,27,33,25,28,21,18,18,25,29,33,24,22,27,29,26,25,17,16,16,23,27,33,21,23,26,25,27,26,22,17,17,25,28,30,20,25,29,30,32,35,25,20,20,37,31,35,25,26,29,34,34,31,29,23,27,35,36,47,50,35,37,39,41,39,26,23,27,34,39,60,43,46,43,48,44,43,50,27,28,45,38,43,34,36,36,36,38,36,24,23,28,32,51,49,40,39,50,59,61,65,48,41,47,100,72,71,56,69,64,48,44,41,32,25,28,60,55,46,34,37,45,43,46,45,38,37,42,47,54,65,44,41,47,50,38],
["exxon",33,33,33,33,33,28,27,27,29,28,31,29,27,30,31,32,30,29,28,30,35,33,31,28,29,34,30,54,37,27,27,28,26,27,26,23,26,29,27,29,31,23,25,24,22,25,26,22,23,35,30,30,31,32,27,28,27,31,26,22,23,24,25,23,21,20,21,21,20,20,19,20,19,19,19,23,39,29,21,17,18,17,17,16,16,17,18,18,17,16,18,20,17,17,16,14,16,16,17,17,18,16,15,14,16,18,16,13,17,15,15,21,15,13,14,13,14,15,15,15,15,15,18,15,15,13,14,13,14,16,14,17,17,21,17,15,14,14,16,18,16,16,16,15,17,16,14,14,14,13,13,12,13,12,13,24,18,16,18,16,15,15,14,15,15,15,14,13,16,16,16,15,16,14,16,14,14,15,14,14,14,14,15,15,14,14,15,15,16,15,15,14,14,17,32,38,22,21,18,18,19,18,16,17,17,21,19,16,18,15,15,14,13,15,14,15,15,18,23,19],
["greenhouse gas",3,4,5,3,3,2,2,3,3,4,4,3,3,5,4,5,4,3,3,3,3,3,4,4,3,4,4,4,4,4,2,3,3,4,5,4,5,6,6,6,6,5,4,4,4,5,5,5,4,5,5,6,5,4,4,3,4,5,4,3,3,4,5,5,4,4,3,3,4,4,4,4,3,4,4,4,4,3,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,3,3,2,2,2,3,3,3,2,2,2,2,2,3,2,2,2,3,3,3,2,2,1,2,2,3,2,2,2,3,3,3,2,1,1,2,3,3,2,2,2,3,3,3,2,2,2,2,3,3,3,2,3,3,3,3,2,1,2,2,3,4,3,3,3,4,3,3,3,2,2,2,3,3,3,3,3,3,4,4,2,2,2,3,4,4,3,3,4,4,4,5,3,2,3,4,5,4,3,4,4,4,5,5,4,3,3,4,4,4,4,4,4,5,5,5,4,3,4,4,4,5,4,4,4,5,4],
["sea level",9,8,8,10,10,8,7,10,14,9,11,9,12,10,9,9,9,8,7,17,25,12,10,9,9,10,10,9,10,8,8,8,8,9,9,9,11,11,9,10,9,8,7,7,8,8,9,8,9,9,8,9,8,7,6,7,9,8,8,7,7,8,9,8,8,6,6,6,8,8,9,9,8,9,8,8,8,7,6,7,7,7,7,6,8,8,10,8,8,7,6,9,8,8,8,7,7,8,9,9,8,8,7,8,9,10,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,8,8,10,8,8,7,8,8,8,8,9,8,8,9,9,8,8,8,9,9,9,9,8,9,10,9,9,8,8,8,9,9,10,8,9,10,10,10,10,9,9,12,21,10,10,9,9,10,11,10,11,9,8,10,12,12,10,10,11,12,11,11,13,11,11,13,15,13,13,11,12,13,9,10,10,9,9,12,14,11,10,10,10,10,11,10,10,10,12,13,12,12,11,10,11,10,11,11],
["deepwater horizon", 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0.5,0.5,0,0.5,0,0,0,0,0,0,0.5,0,0.5,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0,0.5,0,0.5,0,0.5,0.5,0,0,0,0,0.5,0.5,0.5,0.5,0,0,0,12,24,20,9,3,4,3,2,2,2,2,2,3,1,1,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,2,2,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,3,2,3,2,2,4,41,90,21,35,55,25,14,8,7,7,8,7,5,5,6,8,7,5,4,4,3,3,3,4,3,7,7,5,5,5,4,3,4,3,5,3,3,4,3,4,3,6,3,4,4,4,3,3,3,4,3,3,5,3,3,5,3,3,3,4,2,3,2,2,4,3,2,2]
];

month_data = ["Month","2004-01","2004-02","2004-03","2004-04","2004-05","2004-06","2004-07","2004-08","2004-09","2004-10","2004-11","2004-12","2005-01","2005-02","2005-03","2005-04","2005-05","2005-06","2005-07","2005-08","2005-09","2005-10","2005-11","2005-12","2006-01","2006-02","2006-03","2006-04","2006-05","2006-06","2006-07","2006-08","2006-09","2006-10","2006-11","2006-12","2007-01","2007-02","2007-03","2007-04","2007-05","2007-06","2007-07","2007-08","2007-09","2007-10","2007-11","2007-12","2008-01","2008-02","2008-03","2008-04","2008-05","2008-06","2008-07","2008-08","2008-09","2008-10","2008-11","2008-12","2009-01","2009-02","2009-03","2009-04","2009-05","2009-06","2009-07","2009-08","2009-09","2009-10","2009-11","2009-12","2010-01","2010-02","2010-03","2010-04","2010-05","2010-06","2010-07","2010-08","2010-09","2010-10","2010-11","2010-12","2011-01","2011-02","2011-03","2011-04","2011-05","2011-06","2011-07","2011-08","2011-09","2011-10","2011-11","2011-12","2012-01","2012-02","2012-03","2012-04","2012-05","2012-06","2012-07","2012-08","2012-09","2012-10","2012-11","2012-12","2013-01","2013-02","2013-03","2013-04","2013-05","2013-06","2013-07","2013-08","2013-09","2013-10","2013-11","2013-12","2014-01","2014-02","2014-03","2014-04","2014-05","2014-06","2014-07","2014-08","2014-09","2014-10","2014-11","2014-12","2015-01","2015-02","2015-03","2015-04","2015-05","2015-06","2015-07","2015-08","2015-09","2015-10","2015-11","2015-12","2016-01","2016-02","2016-03","2016-04","2016-05","2016-06","2016-07","2016-08","2016-09","2016-10","2016-11","2016-12","2017-01","2017-02","2017-03","2017-04","2017-05","2017-06","2017-07","2017-08","2017-09","2017-10","2017-11","2017-12","2018-01","2018-02","2018-03","2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08","2019-09","2019-10","2019-11","2019-12","2020-01","2020-02","2020-03","2020-04","2020-05","2020-06","2020-07","2020-08","2020-09","2020-10","2020-11","2020-12","2021-01","2021-02","2021-03","2021-04","2021-05","2021-06","2021-07","2021-08","2021-09","2021-10","2021-11","2021-12","2022-01","2022-02","2022-03","2022-04"];

// color array taken from @mucar on github
var colorArray = ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6','#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D','#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A', '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC','#66994D', '#B366CC', '#4D8000', '#B33300', '#CC80CC', '#66664D', '#991AFF', '#E666FF', '#4DB3FF', '#1AB399','#E666B3', '#33991A', '#CC9999', '#B3B31A', '#00E680','#4D8066', '#809980', '#E6FF80', '#1AFF33', '#999933','#FF3380', '#CCCC00', '#66E64D', '#4D80CC', '#9900B3', '#E64D66', '#4DB380', '#FF4D4D', '#99E6E6', '#6666FF'];

// saves index of current month&data displayed
var current_data_point_index = 1;

function setup() {
    createCanvas(windowWidth, windowHeight);
    frameRate(15);

    // set diameter and speed max/min
    max_dia = 100;
    min_dia = 20;
    max_speed = 5;
    min_speed = 0.5;

    // create array to store each Ball and save count
    ball_array = [];
    ball_count = climate_data.length;

    // create each ball
    for( let i = 0; i < ball_count; i++ ) {

        // set Ball motion parameters
        let x_pos = random( 0 + max_dia, windowWidth - max_dia );
        let y_pos = random( 0 + max_dia, windowHeight - max_dia );
        let dx = random(min_speed,max_speed);
        let dy = random(min_speed,max_speed);
        let dia = random( max_dia, min_dia );

        // set Ball data and random color
        let word_data = climate_data[i]
        let color_index = Math.floor(Math.random()*colorArray.length);
        let color = colorArray[color_index];

        // save ball to array
        ball_array[i] = new Ball( x_pos, y_pos, dx, dy, dia, climate_data[i][0], word_data, color);
    }

    // used in draw() to shift diameter every X frames
    move_cycle_skip = 0
}

function draw() {
    // set background to cycle with data
    let background_grade = (current_data_point_index/month_data.length)*(255);
    background(background_grade);

    // draw each ball
    for( let i = 0; i < ball_count; i++ ) {
        if( move_cycle_skip == 10 ) {
            // This is set to let the ball move 10 frames before changing size
            ball_array[i].updateCircleSize();
            move_cycle_skip = 0;
        } else {
            move_cycle_skip++;
        }
        updateMonthCounter( current_data_point_index - 1 );
        ball_array[i].move();
        ball_array[i].display();
    }
}

class Ball {
    constructor( x_pos, y_pos, dx, dy, dia, label, word_data, color ) {
        this.x_pos = x_pos;
        this.y_pos = y_pos;
        this.dx = dx;
        this.dy = dy;
        this.dia = dia;
        this.label = label;
        this.word_data = word_data;
        this.color = color;
    }
    move() {
        // add speed to position
        this.x_pos += this.dx;
        this.y_pos += this.dy;

        // change direction if at wall
        if (this.x_pos > windowWidth - this.dia || this.x_pos < this.dia)
            this.dx = -this.dx;
        if (this.y_pos > windowHeight - this.dia || this.y_pos < this.dia)
            this.dy = -this.dy;
    }
    display() {
        // draw ellipse
        fill(this.color);
        ellipse(this.x_pos, this.y_pos, this.dia, this.dia);

        // write label
        textSize(12);
        fill("black");
        textAlign("center");
        text(this.label, this.x_pos, this.y_pos+this.dia/10);
    }
    updateCircleSize() {
        this.dia = this.word_data[current_data_point_index] * 3 + 75;

        // wrap data back to 1 (skip title) if at end
        if( current_data_point_index < this.word_data.length )
            current_data_point_index++;
        else 
            current_data_point_index = 1;
    }
}

function updateMonthCounter(array_index) {
    textSize(32);
    textAlign("center");
    text( month_data[array_index], windowWidth/2, windowHeight/5);
}